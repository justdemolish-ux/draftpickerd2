<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Draft Picker v9</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-color: #0d0d0d;
            --panel-bg: #161616;
            --input-bg: #0d0d0d;
            --border-color: #222;
            --text-color: #e5e5e5;
            --text-secondary: #888;
            --text-hint: #555;
            --accent-green: #4ade80;
            --accent-red: #f87171;
            --accent-yellow: #fbbf24;
        }
        
        body { 
            background: var(--bg-color); 
            min-height: 100vh; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            color: var(--text-color); 
            padding: 12px;
            padding-bottom: 80px;
        }
        
        .container { max-width: 600px; margin: 0 auto; }
        
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 16px; 
            padding-bottom: 10px; 
            border-bottom: 1px solid var(--border-color); 
        }
        .header h1 { font-size: 1rem; font-weight: 600; }
        .header-info { font-size: 0.6rem; color: var(--text-hint); }
        .header-info span { color: var(--accent-green); }
        .reset-btn { 
            background: transparent; 
            border: 1px solid #333; 
            color: #666; 
            padding: 5px 12px; 
            border-radius: 6px; 
            font-size: 0.7rem; 
            cursor: pointer; 
        }
        
        .team-panel { 
            background: var(--panel-bg); 
            border-radius: 10px; 
            padding: 12px; 
            border: 1px solid var(--border-color); 
            margin-bottom: 10px;
        }
        .team-panel.radiant { border-left: 3px solid var(--accent-green); }
        .team-panel.dire { border-left: 3px solid var(--accent-red); }
        
        .team-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        .team-name { 
            background: transparent; 
            border: none; 
            color: #fff; 
            font-size: 0.9rem; 
            font-weight: 600; 
            width: 60%; 
        }
        .coef-input { 
            background: var(--input-bg); 
            border: 1px solid #333; 
            border-radius: 4px; 
            padding: 5px 8px; 
            color: var(--accent-yellow); 
            font-size: 0.85rem; 
            font-weight: 600; 
            width: 60px; 
            text-align: center; 
        }
        
        .draft-grid { display: flex; flex-wrap: wrap; gap: 5px; }
        .draft-slot { 
            flex: 1 1 calc(50% - 5px);
            min-width: 120px;
            display: flex; 
            align-items: center; 
            gap: 8px; 
            padding: 8px 10px; 
            background: var(--input-bg); 
            border-radius: 6px; 
            border: 1px solid var(--border-color); 
            cursor: pointer; 
        }
        .draft-slot:last-child:nth-child(odd) { flex: 1 1 100%; }
        .draft-slot.active { border-color: var(--accent-yellow); }
        .draft-slot.filled { background: #1a1a1a; }
        .pos-label { font-size: 0.6rem; color: var(--text-hint); width: 28px; }
        .hero-name { flex: 1; font-size: 0.75rem; color: #fff; }
        .hero-wr { font-size: 0.65rem; font-weight: 600; padding: 2px 4px; border-radius: 3px; }
        .hero-wr.good { color: var(--accent-green); background: rgba(74,222,128,0.1); }
        .hero-wr.bad { color: var(--accent-red); background: rgba(248,113,113,0.1); }
        .hero-wr.neutral { color: #666; }
        
        .heroes-section { 
            background: var(--panel-bg); 
            border-radius: 10px; 
            padding: 12px; 
            border: 1px solid var(--border-color); 
            margin-bottom: 12px;
        }
        .search-input { 
            width: 100%; 
            background: var(--input-bg); 
            border: 1px solid var(--border-color); 
            border-radius: 6px; 
            padding: 10px 12px; 
            color: #fff; 
            font-size: 0.85rem; 
            margin-bottom: 10px; 
        }
        .heroes-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); 
            gap: 4px; 
            max-height: 180px; 
            overflow-y: auto; 
        }
        .hero-btn { 
            background: var(--input-bg); 
            border: 1px solid #1a1a1a; 
            border-radius: 4px; 
            padding: 6px 4px; 
            color: #aaa; 
            font-size: 0.6rem; 
            cursor: pointer; 
            text-align: left; 
            position: relative; 
            white-space: nowrap; 
            overflow: hidden; 
        }
        .hero-btn:active { background: #222; }
        .hero-btn.picked { opacity: 0.2; pointer-events: none; }
        .wr-dot { 
            position: absolute; 
            right: 3px; 
            top: 50%; 
            transform: translateY(-50%); 
            width: 5px; 
            height: 5px; 
            border-radius: 50%; 
        }
        .wr-dot.good { background: var(--accent-green); }
        .wr-dot.bad { background: var(--accent-red); }
        
        .analysis-panel { 
            background: var(--panel-bg); 
            border-radius: 10px; 
            padding: 14px; 
            border: 1px solid var(--border-color); 
            display: none; 
            margin-bottom: 12px;
        }
        .analysis-panel.visible { display: block; }
        
        .avg-row { 
            display: grid; 
            grid-template-columns: 1fr auto 1fr; 
            gap: 10px; 
            margin-bottom: 14px; 
        }
        .avg-box { 
            text-align: center; 
            padding: 12px 8px; 
            background: var(--input-bg); 
            border-radius: 8px; 
            border: 2px solid transparent; 
        }
        .avg-box.winner { border-color: var(--accent-green); box-shadow: 0 0 12px rgba(74,222,128,0.15); }
        .avg-box.loser { opacity: 0.5; }
        .avg-val { font-size: 1.5rem; font-weight: 700; }
        .avg-val.high { color: var(--accent-green); }
        .avg-val.low { color: var(--accent-red); }
        .avg-val.mid { color: var(--accent-yellow); }
        .avg-lbl { font-size: 0.65rem; color: var(--text-secondary); margin-top: 2px; }
        .avg-sub { font-size: 0.7rem; color: var(--accent-yellow); margin-top: 4px; }
        .vs-avg { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .diff-val { font-size: 1rem; font-weight: 700; }
        .diff-val.pos { color: var(--accent-green); }
        .diff-val.neg { color: var(--accent-red); }
        .diff-lbl { font-size: 0.55rem; color: #666; }
        
        .rec-box { 
            padding: 16px; 
            border-radius: 10px; 
            text-align: center; 
            margin-bottom: 12px; 
        }
        .rec-box.bet { 
            background: linear-gradient(135deg, rgba(74,222,128,0.15), rgba(74,222,128,0.03)); 
            border: 2px solid var(--accent-green); 
        }
        .rec-box.skip { background: rgba(40,40,40,0.5); border: 1px solid #444; }
        .rec-icon { font-size: 1.8rem; margin-bottom: 6px; }
        .rec-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 4px; }
        .rec-box.bet .rec-title { color: var(--accent-green); }
        .rec-box.skip .rec-title { color: var(--text-secondary); }
        .rec-sub { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 10px; }
        .rec-stake { 
            display: inline-block; 
            background: var(--accent-yellow); 
            color: #000; 
            font-weight: 700; 
            padding: 6px 16px; 
            border-radius: 20px; 
            font-size: 0.85rem; 
        }
        
        .stake-table { 
            background: var(--input-bg); 
            border-radius: 8px; 
            padding: 10px; 
        }
        .stake-table-title { font-size: 0.65rem; color: #666; margin-bottom: 6px; }
        .stake-row { 
            display: flex; 
            justify-content: space-between; 
            font-size: 0.65rem; 
            padding: 4px 0; 
            border-bottom: 1px solid #1a1a1a; 
        }
        .stake-row:last-child { border-bottom: none; }
        .stake-row.active { 
            background: rgba(74,222,128,0.1); 
            margin: 0 -6px; 
            padding: 4px 6px; 
            border-radius: 4px; 
        }
        .stake-cond { color: var(--text-secondary); }
        .stake-val { color: var(--accent-yellow); font-weight: 600; }
        
        .copy-btn { 
            width: 100%; 
            margin-top: 10px; 
            background: #222; 
            border: none; 
            color: #aaa; 
            padding: 12px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 0.8rem; 
        }
        
        .toast { 
            position: fixed; 
            bottom: 90px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: #166534; 
            color: #fff; 
            padding: 10px 18px; 
            border-radius: 6px; 
            font-size: 0.8rem; 
            opacity: 0; 
            transition: all 0.3s; 
            z-index: 100;
        }
        .toast.visible { opacity: 1; }
        
        /* Telegram theme adaptation */
        body.tg-theme-dark {
            --bg-color: var(--tg-theme-bg-color, #0d0d0d);
            --panel-bg: var(--tg-theme-secondary-bg-color, #161616);
            --text-color: var(--tg-theme-text-color, #e5e5e5);
            --accent-green: var(--tg-theme-button-color, #4ade80);
        }
    </style>
</head>
<body>
<!--
================================================================================
DRAFT PICKER v9 ‚Äî TELEGRAM MINI APP VERSION
================================================================================
–î–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–º. —Ñ–∞–π–ª TELEGRAM_MINIAPP_GUIDE.md
================================================================================
-->
    <div class="container">
        <div class="header">
            <h1>üìä Draft Picker</h1>
            <div class="header-info">Avg WR | <span>+10% ROI</span></div>
            <button class="reset-btn" id="resetBtn">–°–±—Ä–æ—Å</button>
        </div>
        
        <div class="team-panel radiant">
            <div class="team-header">
                <input type="text" class="team-name" id="team1Name" placeholder="–ö–æ–º–∞–Ω–¥–∞ 1">
                <input type="text" class="coef-input" id="team1Coef" placeholder="1.50">
            </div>
            <div class="draft-grid" id="draft1"></div>
        </div>
        
        <div class="team-panel dire">
            <div class="team-header">
                <input type="text" class="team-name" id="team2Name" placeholder="–ö–æ–º–∞–Ω–¥–∞ 2">
                <input type="text" class="coef-input" id="team2Coef" placeholder="2.50">
            </div>
            <div class="draft-grid" id="draft2"></div>
        </div>
        
        <div class="heroes-section">
            <input type="text" class="search-input" id="heroSearch" placeholder="–ü–æ–∏—Å–∫ –≥–µ—Ä–æ—è...">
            <div class="heroes-grid" id="heroesGrid"></div>
        </div>
        
        <div class="analysis-panel" id="analysisPanel">
            <div class="avg-row">
                <div class="avg-box" id="avg1Box">
                    <div class="avg-val" id="avg1Val">50.0%</div>
                    <div class="avg-lbl" id="avg1Lbl">Team 1</div>
                    <div class="avg-sub" id="avg1Odds">@ 1.50</div>
                </div>
                <div class="vs-avg">
                    <div class="diff-val" id="diffVal">0%</div>
                    <div class="diff-lbl">diff</div>
                </div>
                <div class="avg-box" id="avg2Box">
                    <div class="avg-val" id="avg2Val">50.0%</div>
                    <div class="avg-lbl" id="avg2Lbl">Team 2</div>
                    <div class="avg-sub" id="avg2Odds">@ 2.50</div>
                </div>
            </div>
            
            <div class="rec-box" id="recBox">
                <div class="rec-icon" id="recIcon">‚è∏Ô∏è</div>
                <div class="rec-title" id="recTitle">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
                <div class="rec-sub" id="recSub"></div>
                <div class="rec-stake" id="recStake">‚Äî</div>
            </div>
            
            <div class="stake-table">
                <div class="stake-table-title">üí∞ –†–ê–ó–ú–ï–† –°–¢–ê–í–ö–ò</div>
                <div class="stake-row" id="row1"><span class="stake-cond">diff < 0.5%</span><span class="stake-val">SKIP</span></div>
                <div class="stake-row" id="row2"><span class="stake-cond">diff 0.5-1%</span><span class="stake-val">0.5 —Ñ–ª</span></div>
                <div class="stake-row" id="row3"><span class="stake-cond">diff 1-3%</span><span class="stake-val">1 —Ñ–ª</span></div>
                <div class="stake-row" id="row4"><span class="stake-cond">diff 3-5%</span><span class="stake-val">1.5 —Ñ–ª</span></div>
                <div class="stake-row" id="row5"><span class="stake-cond">diff ‚â• 5%</span><span class="stake-val">0.5 —Ñ–ª ‚ö†Ô∏è</span></div>
            </div>
            
            <button class="copy-btn" id="copyBtn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</button>
        </div>
    </div>
    <div class="toast" id="toast">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>
    
    <script>
        // Telegram Web App init
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            
            // Apply Telegram theme
            if (tg.colorScheme === 'dark') {
                document.body.classList.add('tg-theme-dark');
            }
            
            // Set header color
            tg.setHeaderColor('#0d0d0d');
            tg.setBackgroundColor('#0d0d0d');
        }
        
        const heroWR = {
            "Abaddon":54.3,"Alchemist":51.2,"Ancient Apparition":50.8,"Anti-Mage":42.9,"Arc Warden":49.5,
            "Axe":52.1,"Bane":51.5,"Batrider":52.3,"Beastmaster":51.8,"Bloodseeker":50.2,
            "Bounty Hunter":55.6,"Brewmaster":50.5,"Bristleback":40.2,"Broodmother":66.3,"Centaur Warrunner":44.8,
            "Chaos Knight":57.1,"Chen":52.1,"Clinkz":57.4,"Clockwerk":51.9,"Crystal Maiden":49.8,
            "Dark Seer":50.3,"Dark Willow":51.2,"Dawnbreaker":53.8,"Dazzle":60.3,"Death Prophet":50.1,
            "Disruptor":49.5,"Doom":38.6,"Dragon Knight":49.0,"Drow Ranger":52.4,"Earth Spirit":47.2,
            "Earthshaker":50.8,"Elder Titan":55.5,"Ember Spirit":50.2,"Enchantress":48.9,"Enigma":50.1,
            "Faceless Void":39.0,"Grimstroke":43.3,"Gyrocopter":47.5,"Hoodwink":49.8,"Huskar":57.5,
            "Invoker":48.2,"Io":62.3,"Jakiro":51.8,"Juggernaut":46.2,"Keeper of the Light":47.8,
            "Kez":50.0,"Kunkka":50.5,"Legion Commander":58.7,"Leshrac":50.8,"Lich":50.2,
            "Lifestealer":49.0,"Lina":50.1,"Lion":49.5,"Lone Druid":40.5,"Luna":56.5,
            "Lycan":57.8,"Magnus":51.2,"Marci":58.7,"Mars":46.8,"Medusa":40.4,
            "Meepo":55.0,"Mirana":44.4,"Monkey King":43.4,"Morphling":42.9,"Muerta":43.8,
            "Naga Siren":41.6,"Nature's Prophet":48.5,"Necrophos":52.8,"Night Stalker":53.2,"Nyx Assassin":51.5,
            "Ogre Magi":54.2,"Omniknight":58.1,"Oracle":50.5,"Outworld Destroyer":44.2,"Pangolier":39.5,
            "Phantom Assassin":35.1,"Phantom Lancer":48.2,"Phoenix":57.2,"Primal Beast":43.1,"Puck":50.8,
            "Pudge":54.5,"Pugna":56.7,"Queen of Pain":49.8,"Razor":55.2,"Riki":44.7,
            "Ringmaster":43.9,"Rubick":51.2,"Sand King":43.5,"Shadow Demon":50.2,"Shadow Fiend":50.8,
            "Shadow Shaman":49.5,"Silencer":42.8,"Skywrath Mage":51.8,"Slardar":50.1,"Slark":43.7,
            "Snapfire":51.5,"Sniper":50.2,"Spectre":39.1,"Spirit Breaker":52.8,"Storm Spirit":42.6,
            "Sven":43.2,"Techies":44.1,"Templar Assassin":50.5,"Terrorblade":43.2,"Tidehunter":48.2,
            "Timbersaw":50.8,"Tinker":47.5,"Tiny":48.5,"Treant Protector":51.2,"Troll Warlord":52.1,
            "Tusk":52.5,"Underlord":47.2,"Undying":57.7,"Ursa":54.2,"Vengeful Spirit":50.8,
            "Venomancer":57.7,"Viper":50.5,"Visage":63.2,"Void Spirit":49.8,"Warlock":50.2,
            "Weaver":48.2,"Windranger":48.3,"Winter Wyvern":57.6,"Witch Doctor":52.5,"Wraith King":50.8,"Zeus":50.5
        };
        
        const heroes = Object.keys(heroWR).sort();
        let picked = {};
        let activeSlot = null;

        function wrClass(wr) { return wr >= 55 ? 'good' : (wr <= 45 ? 'bad' : 'neutral'); }
        function avgClass(avg) { return avg >= 52 ? 'high' : (avg <= 48 ? 'low' : 'mid'); }
        
        function calcAvgWR(team) {
            if (team.length === 0) return 50;
            const wrs = team.map(h => heroWR[h] || 50);
            return wrs.reduce((a, b) => a + b, 0) / wrs.length;
        }

        function getStakeInfo(diff) {
            if (diff < 0.5) return { stake: 0, text: 'SKIP', row: 'row1' };
            if (diff < 1) return { stake: 0.5, text: '0.5 —Ñ–ª–µ—Ç–∞', row: 'row2' };
            if (diff < 3) return { stake: 1, text: '1 —Ñ–ª–µ—Ç', row: 'row3' };
            if (diff < 5) return { stake: 1.5, text: '1.5 —Ñ–ª–µ—Ç–∞', row: 'row4' };
            return { stake: 0.5, text: '0.5 —Ñ–ª–µ—Ç–∞ ‚ö†Ô∏è', row: 'row5' };
        }

        function analyze() {
            const t1 = [], t2 = [];
            for (let i = 1; i <= 5; i++) {
                if (picked[`1-${i}`]) t1.push(picked[`1-${i}`]);
                if (picked[`2-${i}`]) t2.push(picked[`2-${i}`]);
            }
            if (t1.length < 3 || t2.length < 3) {
                document.getElementById('analysisPanel').classList.remove('visible');
                return;
            }
            
            const n1 = document.getElementById('team1Name').value || 'Team 1';
            const n2 = document.getElementById('team2Name').value || 'Team 2';
            const o1 = parseFloat(document.getElementById('team1Coef').value) || 1.9;
            const o2 = parseFloat(document.getElementById('team2Coef').value) || 1.9;
            
            const avg1 = calcAvgWR(t1);
            const avg2 = calcAvgWR(t2);
            const diff = Math.abs(avg1 - avg2);
            
            document.getElementById('avg1Val').textContent = avg1.toFixed(1) + '%';
            document.getElementById('avg1Val').className = 'avg-val ' + avgClass(avg1);
            document.getElementById('avg1Lbl').textContent = n1;
            document.getElementById('avg1Odds').textContent = `@ ${o1.toFixed(2)}`;
            
            document.getElementById('avg2Val').textContent = avg2.toFixed(1) + '%';
            document.getElementById('avg2Val').className = 'avg-val ' + avgClass(avg2);
            document.getElementById('avg2Lbl').textContent = n2;
            document.getElementById('avg2Odds').textContent = `@ ${o2.toFixed(2)}`;
            
            document.getElementById('diffVal').textContent = diff.toFixed(1) + '%';
            document.getElementById('diffVal').className = 'diff-val ' + (diff >= 1 ? 'pos' : 'neg');
            
            const pick = avg1 > avg2 ? 1 : (avg2 > avg1 ? 2 : 1);
            const pickN = pick === 1 ? n1 : n2;
            const pickO = pick === 1 ? o1 : o2;
            
            document.getElementById('avg1Box').className = 'avg-box ' + (pick === 1 ? 'winner' : 'loser');
            document.getElementById('avg2Box').className = 'avg-box ' + (pick === 2 ? 'winner' : 'loser');
            
            const stakeInfo = getStakeInfo(diff);
            
            ['row1', 'row2', 'row3', 'row4', 'row5'].forEach(r => {
                document.getElementById(r).classList.remove('active');
            });
            document.getElementById(stakeInfo.row).classList.add('active');
            
            const rec = document.getElementById('recBox');
            if (stakeInfo.stake === 0) {
                rec.className = 'rec-box skip';
                document.getElementById('recIcon').textContent = '‚è∏Ô∏è';
                document.getElementById('recTitle').textContent = 'SKIP';
                document.getElementById('recSub').textContent = `Diff ${diff.toFixed(1)}% ‚Äî –º–∞–ª–æ`;
                document.getElementById('recStake').textContent = '–ù–µ —Å—Ç–∞–≤–∏—Ç—å';
                document.getElementById('recStake').style.background = '#666';
            } else {
                rec.className = 'rec-box bet';
                document.getElementById('recIcon').textContent = '‚úÖ';
                document.getElementById('recTitle').textContent = `${pickN} @ ${pickO.toFixed(2)}`;
                document.getElementById('recSub').textContent = `Avg WR: ${(pick === 1 ? avg1 : avg2).toFixed(1)}% | Diff: ${diff.toFixed(1)}%`;
                document.getElementById('recStake').textContent = stakeInfo.text;
                document.getElementById('recStake').style.background = '#fbbf24';
            }
            
            document.getElementById('analysisPanel').classList.add('visible');
            
            window.data = {n1, n2, t1, t2, o1, o2, avg1, avg2, diff, pickN, pickO, stake: stakeInfo.text};
        }

        function initGrid() {
            [1, 2].forEach(team => {
                const cont = document.getElementById(`draft${team}`);
                for (let i = 1; i <= 5; i++) {
                    const slot = document.createElement('div');
                    slot.className = 'draft-slot';
                    slot.dataset.team = team;
                    slot.dataset.pos = i;
                    slot.innerHTML = `<span class="pos-label">pos${i}</span>`;
                    slot.onclick = () => clickSlot(slot);
                    cont.appendChild(slot);
                }
            });
            
            const grid = document.getElementById('heroesGrid');
            heroes.forEach(h => {
                const btn = document.createElement('button');
                btn.className = 'hero-btn';
                btn.textContent = h;
                btn.dataset.hero = h;
                const dot = document.createElement('span');
                dot.className = 'wr-dot ' + wrClass(heroWR[h]);
                btn.appendChild(dot);
                btn.onclick = () => pickHero(h);
                grid.appendChild(btn);
            });
        }

        function clickSlot(slot) {
            if (slot.classList.contains('filled')) {
                const h = slot.dataset.hero;
                delete picked[`${slot.dataset.team}-${slot.dataset.pos}`];
                slot.classList.remove('filled');
                slot.dataset.hero = '';
                slot.querySelectorAll('.hero-name, .hero-wr').forEach(e => e.remove());
                document.querySelector(`.hero-btn[data-hero="${h}"]`)?.classList.remove('picked');
                analyze();
            } else {
                document.querySelectorAll('.draft-slot').forEach(s => s.classList.remove('active'));
                slot.classList.add('active');
                activeSlot = slot;
            }
        }

        function pickHero(h) {
            if (!activeSlot || activeSlot.classList.contains('filled')) {
                activeSlot = document.querySelector('.draft-slot:not(.filled)');
                if (!activeSlot) return;
                document.querySelectorAll('.draft-slot').forEach(s => s.classList.remove('active'));
                activeSlot.classList.add('active');
            }
            
            const key = `${activeSlot.dataset.team}-${activeSlot.dataset.pos}`;
            picked[key] = h;
            activeSlot.classList.add('filled');
            activeSlot.dataset.hero = h;
            
            const nm = document.createElement('span');
            nm.className = 'hero-name';
            nm.textContent = h;
            activeSlot.appendChild(nm);
            
            const wr = heroWR[h];
            const wrEl = document.createElement('span');
            wrEl.className = 'hero-wr ' + wrClass(wr);
            wrEl.textContent = wr.toFixed(0) + '%';
            activeSlot.appendChild(wrEl);
            
            document.querySelector(`.hero-btn[data-hero="${h}"]`)?.classList.add('picked');
            activeSlot.classList.remove('active');
            
            activeSlot = document.querySelector('.draft-slot:not(.filled)');
            if (activeSlot) activeSlot.classList.add('active');
            
            analyze();
            
            // Haptic feedback in Telegram
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.selectionChanged();
            }
        }

        document.getElementById('heroSearch').oninput = e => {
            const s = e.target.value.toLowerCase();
            document.querySelectorAll('.hero-btn').forEach(b => {
                b.style.display = b.dataset.hero.toLowerCase().includes(s) ? 'block' : 'none';
            });
        };

        document.getElementById('resetBtn').onclick = () => {
            picked = {};
            document.querySelectorAll('.draft-slot').forEach(s => {
                s.classList.remove('filled', 'active');
                s.dataset.hero = '';
                s.querySelectorAll('.hero-name, .hero-wr').forEach(e => e.remove());
            });
            document.querySelectorAll('.hero-btn').forEach(b => b.classList.remove('picked'));
            document.getElementById('analysisPanel').classList.remove('visible');
            ['team1Name', 'team2Name', 'team1Coef', 'team2Coef', 'heroSearch'].forEach(id => document.getElementById(id).value = '');
            const first = document.querySelector('.draft-slot');
            first.classList.add('active');
            activeSlot = first;
            
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }
        };

        document.getElementById('copyBtn').onclick = () => {
            if (!window.data) return;
            const d = window.data;
            const txt = `${d.n1} vs ${d.n2}
${d.o1.toFixed(2)} / ${d.o2.toFixed(2)}

${d.n1}: ${d.t1.join(', ')}
Avg WR: ${d.avg1.toFixed(1)}%

${d.n2}: ${d.t2.join(', ')}
Avg WR: ${d.avg2.toFixed(1)}%

Diff: ${d.diff.toFixed(1)}%

‚Üí ${d.stake === 'SKIP' ? 'SKIP' : d.pickN + ' @ ' + d.pickO.toFixed(2) + ' | ' + d.stake}`;
            
            navigator.clipboard.writeText(txt).then(() => {
                const toast = document.getElementById('toast');
                toast.classList.add('visible');
                setTimeout(() => toast.classList.remove('visible'), 2000);
                
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }
            });
        };

        ['team1Name', 'team2Name', 'team1Coef', 'team2Coef'].forEach(id => {
            document.getElementById(id).oninput = analyze;
        });

        initGrid();
        document.querySelector('.draft-slot').classList.add('active');
        activeSlot = document.querySelector('.draft-slot');
    </script>
</body>
</html>
